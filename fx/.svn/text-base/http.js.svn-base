/**
 * Http server module
 *
 */

/* BEGIN INCLUDES */

var express = require('express');
var fx = require('../fx/fx.js');

/* END INCLUDES */

/* BEGIN VARIABLES */

var conf;
var app = express.createServer();
var RedisStore = require('connect-redis')(express);
var io = require('socket.io').listen(app);

/* END VARIABLES */

/* BEGIN ACTIONS */

app.use(express.bodyParser());
//app.use(express.cookieParser());
//app.use(express.session({ secret: "keyboard cat", store: new RedisStore }));
app.set('view engine', 'jade');
app.set('view options', {
    layout: false
});

/* END ACTIONS */

/* BEGIN EXPORTS */

exports.init = function(c) {
    fx.log.act('[http] initialising http');
    conf = c;

    app.use('/styles', express.static(conf.root_dir + conf.styles_dir));
    app.use('/scripts', express.static(conf.root_dir + conf.scripts_dir));
    app.use('/images', express.static(conf.root_dir + conf.images_dir));
};

exports.get = function(path, callback) {
    fx.log.act('[http] registering callback for path ' + path);
    app.get(path, callback);
}

exports.start = function() {
    fx.log.act('[http] listening for HTTP requests on ' + conf.http_host + ':' + conf.http_port);
    app.listen(conf.http_port);
}

/* END EXPORTS */